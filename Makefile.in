# $Id: Makefile.in,v 1.22 2004-08-09 09:02:59 oops Exp $
srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
builddir	= @builddir@
top_builddir	= .

build           = @build@
build_cpu       = @build_cpu@
build_vendor    = @build_vendor@
build_os        = @build_os@
host            = @host@
host_cpu        = @host_cpu@
host_vendor     = @host_vendor@

PROG		= @PACKAGE_NAME@
VERSION		= @PACKAGE_VERSION@
SHELL		= @SHELL@
CC		= @CC@ -Wall
CPP		= @CPP@
CFLAGS		= @CFLAGS@
CPPFLAGS	= -I. -Ipcrelib -Ilibidn @CPPFLAGS@
LDFLAGS		= @LDFLAGS@ $(LIBS)
LIBS		= @LIBS@
DEFS		= @DEFS@ $(CPPFLAGS)
OBJECT		= libmisc.lo libidn.lo libstring.lo libpcre.lo libfile.lo libtime.lo libarg.lo _race.lo
PCREOBJ		= pcrelib/get.lo pcrelib/maketables.lo pcrelib/pcre.lo pcrelib/study.lo
IDNOBJ		= libidn/idna.lo libidn/nfkc.lo libidn/profiles.lo libidn/punycode.lo \
		  libidn/stringprep.lo libidn/rfc3454.lo libidn/toutf8.lo
OBOBJ		= libmisc.lo libstring.lo libpcre.lo libfile.lo libtime.lo libarg.lo
OGOBJ		= libstring.lo libmisc.lo _race.lo libidn.lo
HEADER_NAME	= olibc-config oc_common libfile libpcre libstring libtime libarg libidn

SONAME_MAJOR	= @SONAME_MAJOR@
SONAME_MINOR	= @SONAME_MINOR@
SONAME_REVISION	= @SONAME_REVISION@
SONAME_INFO	= @SONAME_INFO@
SONAME_VERSION	= @SONAME_VERSION@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
datadir		= @datadir@
includedir	= @includedir@
libdir		= @libdir@
bindir		= @bindir@
DESTDIR		=

LIBTOOL		= @LIBTOOL@
INSTALL		= @INSTALL@
RM		= @RM@ -f
MAKE		= @MAKE@
MKDIR		= @MKDIR@ -p
STRIP		= @STRIP@
LN		= @LN_S@
MV		= @MV@
PERL		= @PERL@

CC_OPT		= $(CC) $(CFLAGS)
LINK		= $(LIBTOOL) --mode=link $(CC_OPT) -rpath $(libdir) -version $(SONAME_INFO)
COMPILE		= $(LIBTOOL) --mode=compile $(CC_OPT) $(DEFS) -prefer-pic
P_LIBTOOL	= $(LIBTOOL) --mode=install @INSTALL_PROGRAM@ -m755
D_LIBTOOL	= $(LIBTOOL) --mode=install @INSTALL_DATA@
L_LIBTOOL	= $(LIBTOOL) --mode=install $(INSTALL)
INSTALL_SCRIPT	= @INSTALL_SCRIPT@

all: pcre idn $(OBJECT) libs olibc-config

libmisc.lo: libmisc.c olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libidn.lo: libidn.c libidn.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libpcre.lo: libpcre.c libpcre.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libstring.lo: libstring.c libstring.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libfile.lo: libfile.c libfile.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libtime.lo: libtime.c libtime.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

libarg.lo: libarg.c libarg.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

_race.lo: _race.c _race.h olibc-config.h oc_common.h
	$(COMPILE) -o $@ -c $<

pcre:
	$(MAKE) -C pcrelib

idn:
	$(MAKE) -C libidn

libs:
	$(LINK) -o lib$(PROG).la $(OBJECT) $(PCREOBJ) $(IDNOBJ) $(LDFALGS)
	$(LINK) -o liboc.la $(OBOBJ) $(PCREOBJ)
	$(LINK) -o libogc.la $(OGOBJ) $(IDNOBJ) $(LDFALGS)

olibc-config:
	for i in olibc ogc oc ; do \
		$(INSTALL)  olibc-config.in $$i-config ; \
		$(PERL) -pi -e "s!\@prefix\@!$(prefix)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@exec_prefix\@!$(exec_prefix)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@VERSION\@!$(VERSION)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@includedir\@!$(includedir)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@libdir\@!$(libdir)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@CFLAGS\@!$(CFLAGS)!g" $$i-config ; \
		$(PERL) -pi -e "s!\@prog\@!$$i!g" $$i-config ; \
	done

install: install-doc install-header
	$(MKDIR) $(DESTDIR)$(bindir)
	$(MKDIR) $(DESTDIR)$(libdir)
	for i in olibc ogc oc ; do \
		$(P_LIBTOOL) $$i-config $(DESTDIR)$(bindir) ; \
		$(L_LIBTOOL) lib$$i.la $(DESTDIR)$(libdir)/lib$$i.la ; \
		$(LIBTOOL) --finish $(libdir) ; \
	done

install-header:
	$(MKDIR) $(DESTDIR)$(includedir)
	for i in $(HEADER_NAME) ; do \
		$(D_LIBTOOL) $$i.h $(DESTDIR)$(includedir)/ ; \
	done

install-doc:
	$(MAKE) -C man install

clean:
	$(MAKE) -C pcrelib clean
	$(MAKE) -C libidn clean
	-$(RM) -f *.o *.lo *.la *.so* *.a main olibc-config .libs/* *-config

distclean: clean
	-$(RM) -f olibc-config.h config.log config.status Makefile man/Makefile pcrelib/Makefile libidn/Makefile *~
	-$(RM) -rf autom4te* libidn/idn-int.h stamp* .libs libtool libidn/.libs pcrelib/.libs
